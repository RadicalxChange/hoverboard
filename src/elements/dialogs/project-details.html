<link rel="import" href="../../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../../bower_components/app-layout/app-scroll-effects/effects/waterfall.html">
<link rel="import" href="../../../bower_components/app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../../../bower_components/plastic-image/plastic-image.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-overlay-behavior/iron-overlay-behavior.html">
<link rel="import" href="../../../bower_components/marked-element/marked-element.html">

<link rel="import" href="../../mixins/utils-functions.html">
<link rel="import" href="../../mixins/redux-mixin.html">
<link rel="import" href="../text-truncate.html">
<link rel="import" href="../shared-styles.html">
<link rel="import" href="dialog-styles.html">

<dom-module id="project-details">
  <template>
    <style is="custom-style" include="shared-styles dialog-styles flex flex-alignment positioning"></style>

    <style>
      .action {
        color: var(--secondary-text-color);
      }

    </style>

    <polymer-helmet
      title="[[project.name]] | {$ title $}"
      description="[[project.decription]]"
      active="[[opened]]"
    ></polymer-helmet>

    <app-header-layout has-scrolling-region>
      <app-header slot="header" class="header" fixed="[[viewport.isTabletPlus]]">
        <iron-icon
          class="close-icon"
          icon="hoverboard:[[_getCloseBtnIcon(viewport.isLaptopPlus)]]"
          on-tap="_close"
        ></iron-icon>

        <app-toolbar>
          <div class="dialog-container header-content" layout horizontal center>
            <h2 class="name" flex>[[project.name]]</h2>
          </div>
        </app-toolbar>
      </app-header>

      <div class="dialog-container content">

        <marked-element class="description" markdown="[[project.description]]">
          <div slot="markdown-html"></div>
        </marked-element>

        <h2 class="name" flex>Number of contributions: [[project.contributions.length]]</h2>


      </div>
    </app-header-layout>

  </template>

  <script>

    // TODO Mixin for shared properties
    // eslint-disable-next-line no-undef
    class ProjectDetails extends UtilsFunctions(
      // eslint-disable-next-line no-undef
      ReduxMixin(Polymer.mixinBehaviors([Polymer.IronOverlayBehavior], Polymer.Element))
    ) {
      static get is() {
        return 'project-details';
      }

      static get properties() {
        return {
          project: {
            type: Object,
          },
          viewport: {
            type: Object,
            statePath: 'ui.viewport',
          },
          projects: {
            type: Array,
            statePath: 'projects.list',
          },
          projectsFetching: {
            type: Boolean,
            statePath: 'projects.fetching',
          },
          projectsFetchingError: {
            type: Object,
            statePath: 'projects.fetchingError',
          },
          user: {
            type: Object,
            statePath: 'user',
          },
        };
      }

      constructor() {
        super();
        this.addEventListener('iron-overlay-canceled', this._close);
      }

      connectedCallback() {
        super.connectedCallback();

        if (!this.projectsFetching && (!this.projects || !this.projects.length)) {
         this.dispatch(fundraiserActions.fetchList());
        }
      }

      _close() {
        dialogsActions.closeDialog(DIALOGS.PROJECT);
      }

      _getCloseBtnIcon(isLaptopViewport) {
        return isLaptopViewport ? 'close' : 'arrow-left';
      }
    }

    window.customElements.define(ProjectDetails.is, ProjectDetails);
  </script>
</dom-module>
